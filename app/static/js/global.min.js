const THEME_KEY="theme",THEMES=["light","dark","night","black"];window.getSystemTheme=function(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},window.getStoredTheme=function(){return localStorage.getItem("theme")},window.applyTheme=function(e){document.documentElement.dataset.theme=e,localStorage.setItem("theme",e)},window.initializeTheme=function(){const e=window.getStoredTheme();let t=window.getSystemTheme();e&&THEMES.includes(e)&&(t=e),window.applyTheme(t)};let translations={};window._=function(e,...t){let n=translations[e]||e;return t.length>0&&(n=n.replace(/%s/g,()=>t.shift())),n},"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/static/sw.js",{scope:"/"}).catch(e=>{console.error("ServiceWorker registration failed: ",e)})}),document.addEventListener("DOMContentLoaded",async()=>{window.initializeTheme();const e=document.documentElement.lang||"en";try{const t=await fetch(`/api/translations?lang=${e}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);translations=await t.json()}catch(e){console.error("Could not fetch translations:",e)}const t=document.getElementById("language-switcher");t&&t.addEventListener("click",()=>{const e="ja"===(document.documentElement.lang||"en")?"en":"ja",t=new URL(window.location.href);t.searchParams.set("lang",e),window.location.href=t.toString()});const n=document.getElementById("menu-toggle"),o=document.getElementById("nav-links");n&&o&&(n.addEventListener("click",e=>{e.stopPropagation(),o.classList.toggle("hidden")}),document.body.addEventListener("click",()=>{o.classList.contains("hidden")||o.classList.add("hidden")}))});
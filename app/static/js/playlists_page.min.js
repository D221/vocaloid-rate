document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("create-new-playlist-btn");t&&t.addEventListener("click",()=>{const t=prompt("Enter a name for your new playlist:");t&&t.trim()&&fetch("/api/playlists",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.trim()})}).then(t=>{t.ok?window.location.reload():alert("Failed to create playlist.")})});const e=document.getElementById("import-single-playlist-input"),a=document.getElementById("import-status"),o=document.querySelector(".space-y-4");o&&o.addEventListener("click",async t=>{const e=t.target.closest("[data-export-single-playlist]"),a=t.target.closest("[data-delete-playlist]");if(e){const t=e.dataset.exportSinglePlaylist;try{const e=await fetch(`/api/playlists/${t}/export`),a=await e.json(),o=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),n=URL.createObjectURL(o),s=document.createElement("a");s.href=n;const l=a.name.replace(/[^a-z0-9]/gi,"_").toLowerCase();s.download=`playlist_${l}.json`,s.click(),URL.revokeObjectURL(n)}catch(t){alert("Failed to export playlist."),console.error(t)}}if(a){const t=a.dataset.deletePlaylist,e=a.dataset.playlistName;if(confirm(`Are you sure you want to delete the playlist "${e}"? This cannot be undone.`))try{if(!(await fetch(`/api/playlists/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete playlist.");a.closest(".flex.items-center.justify-between").remove()}catch(t){alert(t.message)}}}),e&&e.addEventListener("change",async()=>{const t=e.files[0];if(!t)return;a.textContent="Importing...";const o=new FormData;o.append("file",t);try{const t=await fetch("/api/playlists/import-single",{method:"POST",body:o});if(!t.ok){const e=await t.json();throw new Error(e.detail||"Import failed")}const e=await t.json();a.textContent=`Success! Playlist ${e.status}. Reloading...`,setTimeout(()=>window.location.reload(),2e3)}catch(t){a.textContent=`Error: ${t.message}`}})});
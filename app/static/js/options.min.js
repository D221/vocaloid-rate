document.addEventListener("DOMContentLoaded",()=>{!function(){const e=window.getStoredTheme()||window.getSystemTheme(),t=document.querySelector(`input[name="theme-select"][value="${e}"]`);t&&(t.checked=!0)}();document.querySelectorAll('input[name="theme-select"]').forEach(e=>{e.addEventListener("change",e=>{window.applyTheme(e.target.value)})});const e=document.getElementById("backup-button"),t=document.getElementById("restore-button"),n=document.getElementById("restore-file-input"),o=document.getElementById("restore-status"),a=document.getElementById("restore-spinner"),c=document.getElementById("default-page-size-select");if(c){const e=localStorage.getItem("defaultPageSize")||"all";c.value=e,c.addEventListener("change",()=>{localStorage.setItem("defaultPageSize",c.value)})}n&&n.addEventListener("change",()=>{t.disabled=!n.files.length}),e&&e.addEventListener("click",async()=>{try{const e=await fetch("/api/backup/ratings");if(!e.ok)throw new Error("Failed to fetch backup data.");const t=await e.json(),n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),o=URL.createObjectURL(n),a=document.createElement("a");a.href=o,a.download=`vocaloid_ratings_backup_${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}catch(e){console.error("Backup failed:",e),alert("Backup failed. See console for details.")}}),t&&t.addEventListener("click",async()=>{const e=n.files[0];if(!e)return void(o.textContent="Please select a file to restore.");t.disabled=!0,o.textContent="Restoring...",a.style.display="inline-block";const c=new FormData;c.append("file",e);try{const e=await fetch("/api/restore/ratings",{method:"POST",body:c});if(!e.ok){const t=await e.json();throw new Error(t.detail||"Restore failed.")}const t=await e.json();o.textContent=`Restore successful! ${t.created} tracks created, ${t.updated} tracks updated.`}catch(e){console.error("Restore failed:",e),o.textContent=`Error: ${e.message}`}finally{t.disabled=!1,a.style.display="none"}});const d="viewModeSlim",l=document.getElementById("slim-mode-toggle");if(l){const e="true"===localStorage.getItem(d);l.checked=e,l.addEventListener("change",()=>{const e=l.checked;localStorage.setItem(d,e),window.location.reload()})}});
<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Vocaloid Rater{% endblock %}</title>

    <!-- Favicon Links -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="{{ url_for('static', path='apple-touch-icon.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="{{ url_for('static', path='favicon-32x32.png') }}"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="{{ url_for('static', path='favicon-16x16.png') }}"
    />
    <link
      rel="manifest"
      href="{{ url_for('static', path='site.webmanifest') }}"
    />
    <link
      rel="shortcut icon"
      href="{{ url_for('static', path='favicon.ico') }}"
    />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />

    <link rel="stylesheet" href="{{ url_for('static', path='css/app.css') }}" />
    <script>
      // Apply theme immediately to prevent flashing
      (function () {
        const savedTheme = localStorage.getItem("theme");
        if (savedTheme) {
          document.documentElement.dataset.theme = savedTheme;
        } else {
          const prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;
          document.documentElement.dataset.theme = prefersDark
            ? "dark"
            : "light";
        }
      })();
    </script>
    {% block head_extra %}{% endblock %}
  </head>

  <body class="m-4 bg-background font-sans text-foreground">
    {% from "macros/icons.html" import render as icon %}
    <div
      id="music-player"
      class="fixed right-0 bottom-0 left-0 z-1000 hidden h-24 border-t-2 border-border bg-background px-5 shadow-md"
    >
      <div class="flex items-center justify-between">
        <!-- Left Column -->
        <div class="hidden items-center gap-4 md:flex">
          <img
            id="player-thumbnail"
            class="h-12 w-12 shrink-0 rounded object-cover"
            src=""
            alt="Track thumbnail"
          />
          <div class="grow overflow-hidden">
            <p
              id="player-title"
              class="m-0 max-w-64 overflow-hidden text-[0.9em] font-bold overflow-ellipsis whitespace-nowrap"
            ></p>
            <p
              id="player-producer"
              class="m-0 max-w-64 overflow-hidden text-[0.9em] overflow-ellipsis whitespace-nowrap"
            ></p>
          </div>
          <button
            id="player-jump-to-btn"
            class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
            title="Jump to playing track"
          >
            {{ icon('arrow-up', size="h-6 w-6") }}
          </button>
          <button
            id="player-embed-btn"
            class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
            title="Toggle Video/Audio Mode"
          >
            {{ icon('tv', size="h-6 w-6") }}
          </button>
        </div>

        <!-- Right Column -->
        <div class="hidden items-center gap-4 md:flex">
          <button
            id="player-mute-btn"
            class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
            title="Mute/Unmute"
          >
            {{ icon('volume-high', size="h-8 w-8") }}
          </button>
          <input
            type="range"
            id="player-volume-slider"
            min="0"
            max="100"
            value="100"
            title="Volume"
            class="w-24"
          />
          <button
            id="player-stop-btn"
            class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-2xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
            title="Close Player"
          >
            {{ icon('xmark', size="h-8 w-8") }}
          </button>
        </div>
      </div>

      <!-- Middle Column -->
      <div
        class="pointer-events-none absolute inset-x-0 top-0 bottom-0 flex flex-col items-center justify-center"
      >
        <div
          class="pointer-events-auto flex w-[45vw] max-w-[700px] min-w-[350px] flex-col items-center gap-1"
        >
          <div class="flex w-full items-center gap-2">
            <span
              class="min-w-9 text-center text-[0.8em]"
              id="player-current-time"
              >0:00</span
            >
            <input
              class="grow cursor-pointer"
              type="range"
              id="player-progress-bar"
              min="0"
              max="100"
              value="0"
              step="0.1"
            />
            <span class="min-w-9 text-center text-[0.8em]" id="player-duration"
              >0:00</span
            >
          </div>
          <div class="flex items-center justify-center gap-4">
            <button
              id="player-repeat-btn"
              class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
              title="Repeat"
            >
              {{ icon('repeat', size="h-6 w-6") }}
            </button>
            <button
              id="player-prev-btn"
              class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
              title="Previous Track"
            >
              {{ icon('backward', size="h-6 w-6") }}
            </button>
            <button
              id="player-play-pause-btn"
              class="flex h-12 w-12 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-cyan-600 p-0 text-2xl text-white ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-cyan-700"
              title="Play/Pause"
            >
              {{ icon('play', size="h-8 w-8") }}
            </button>
            <button
              id="player-next-btn"
              class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
              title="Next Track"
            >
              {{ icon('forward', size="h-6 w-6") }}
            </button>
            <button
              id="player-shuffle-btn"
              class="flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full border-0 bg-transparent p-0 text-xl ease-in-out hover:transition-colors hover:duration-200 enabled:hover:bg-gray-hover"
              title="Shuffle"
            >
              {{ icon('shuffle', size="h-6 w-6") }}
            </button>
          </div>
        </div>
      </div>
    </div>

    {% block content %}{% endblock %}

    <footer
      class="mt-12 border-t border-border pt-6 text-center text-foreground"
    >
      <p>
        Data sourced from
        <a
          class="text-cyan-text"
          href="https://vocaloard.injpok.tokyo/en/"
          target="_blank"
          >Vocaloard</a
        >. This is an independent project.
      </p>
    </footer>

    <div
      id="youtube-player-container"
      style="position: fixed; top: -9999px; left: -9999px;"
    ></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  </body>
</html>

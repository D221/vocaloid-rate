{% extends "base.html" %}

{% block title %}Vocaloid Tracks - Vocaloid Rater{% endblock %}

{% block content %}
<div class="header-container">
    <h1>Vocaloid Tracks</h1>
    <div class="header-controls">
        <a href="/rated_tracks" class="header-button">View Rated Tracks</a>
        <a href="/options" class="header-button">Options</a>
        <div class="theme-switcher" id="theme-switcher">
            <span id="theme-icon">&#127769;</span>
            <span id="theme-text">Dark Mode</span>
        </div>
    </div>
</div>

<div class="filter-container">
    <form id="filter-form">
        <div class="filter-group">
            <label>Chart Status:</label>
            <input type="radio" id="rank_ranked" name="rank_filter" value="ranked" {% if filters.rank_filter=='ranked'
                or not filters.rank_filter %}checked{% endif %}>
            <label for="rank_ranked">On Chart</label>

            <input type="radio" id="rank_unranked" name="rank_filter" value="unranked" {% if
                filters.rank_filter=='unranked' %}checked{% endif %}>
            <label for="rank_unranked">Expired (Archive)</label>

            <input type="radio" id="rank_all" name="rank_filter" value="all" {% if filters.rank_filter=='all'
                %}checked{% endif %}>
            <label for="rank_all">Show All</label>
        </div>

        <label for="rated_filter">Rating:</label>
        <select name="rated_filter" id="rated_filter">
            <option value="all" {% if filters.rated_filter=='all' %}selected{% endif %}>All</option>
            <option value="rated" {% if filters.rated_filter=='rated' %}selected{% endif %}>Rated</option>
            <option value="unrated" {% if filters.rated_filter=='unrated' %}selected{% endif %}>Unrated</option>
        </select>
        <label for="title_filter">Title:</label>
        <div class="input-wrapper">
            <input type="search" name="title_filter" id="title_filter" autocomplete="off"
                value="{{ filters.title_filter or '' }}">
            <button type="button" class="clear-input-btn" aria-label="Clear title search">&times;</button>
        </div>
        <label for="producer_filter">Producer:</label>
        <div class="input-wrapper">
            <input type="text" name="producer_filter" id="producer_filter" list="producers-list" autocomplete="off"
                value="{{ filters.producer_filter or '' }}">
            <button type="button" class="clear-input-btn" aria-label="Clear producer filter">&times;</button>
        </div>
        <datalist id="producers-list">
            {% for producer in all_producers %}<option value="{{ producer }}">{% endfor %}
        </datalist>

        <label for="voicebank_filter">Voicebank:</label>
        <div class="input-wrapper">
            <input type="text" name="voicebank_filter" id="voicebank_filter" list="voicebanks-list" autocomplete="off"
                value="{{ filters.voicebank_filter or '' }}">
            <button type="button" class="clear-input-btn" aria-label="Clear voicebank filter">&times;</button>
        </div>
        <datalist id="voicebanks-list">
            {% for voicebank in all_voicebanks %}<option value="{{ voicebank }}">{% endfor %}
        </datalist>
        <a href="/" class="clear button">Clear</a>

        <label for="limit_filter">Per Page:</label>
        <select id="limit_filter">
            <option value="all" {% if pagination.limit=='all' %}selected{% endif %}>All</option>
            <option value="25" {% if pagination.limit=='25' %}selected{% endif %}>25</option>
            <option value="50" {% if pagination.limit=='50' %}selected{% endif %}>50</option>
            <option value="100" {% if pagination.limit=='100' %}selected{% endif %}>100</option>
        </select>

        <button type="button" id="scrape-button">Update Tracks</button>
        <span id="last-updated">
            {% if last_update %}
            Last updated: {{ last_update.updated_at.strftime('%Y-%m-%d %H:%M') }}
            {% endif %}
        </span>
        <span id="scrape-status"></span>
    </form>
</div>
<div class="table-wrapper">
    <table>
        <thead id="tracks-table-head">
            <tr>
                <th>Image</th>
                <th><a href="/?sort_by=rank" data-sort="rank">Rank</a></th>
                <th class="truncate-cell"><a href="/?sort_by=title" data-sort="title">Title</a></th>
                <th class="truncate-cell"><a href="/?sort_by=producer" data-sort="producer">Producer</a></th>
                <th class="truncate-cell"><a href="/?sort_by=voicebank" data-sort="voicebank">Voicebank</a></th>
                <th><a href="/?sort_by=published_date" data-sort="published_date">Published</a></th>
                <th><a href="/?sort_by=rating" data-sort="rating">My Rating</a></th>
            </tr>
        </thead>
        <tbody id="tracks-table-body" data-update-url="/_/tracks_table_body">
            {% include "partials/tracks_table_body.html" %}
        </tbody>
    </table>
</div>

<div class="pagination-container" id="pagination-container">
    <button id="prev-page-btn" disabled>Previous</button>
    <div id="page-links"></div>
    <button id="next-page-btn" disabled>Next</button>
</div>
<script src="{{ url_for('static', path='js/main.js') }}"></script>
{% endblock %}